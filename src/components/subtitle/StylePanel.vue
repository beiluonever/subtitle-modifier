<template>
  <div class="style-panel">
    <el-card class="style-card">
      <template #header>
        <div class="card-header">
          <span>Ê†∑ÂºèËÆæÁΩÆ</span>
          <el-button-group>
            <el-button size="small" @click="loadPreset">
              üìö
              È¢ÑËÆæ
            </el-button>
            <el-button size="small" @click="savePreset">
              ‚ûï
              ‰øùÂ≠ò
            </el-button>
          </el-button-group>
        </div>
      </template>
      
      <div class="style-content">
        <el-form :model="styleForm" label-width="100px" size="small">
          <!-- Âü∫Á°ÄÊ†∑Âºè -->
          <el-divider content-position="left">Âü∫Á°ÄÊ†∑Âºè</el-divider>
          
          <el-form-item label="Â≠ó‰Ωì">
            <el-select v-model="styleForm.fontName" placeholder="ÈÄâÊã©Â≠ó‰Ωì">
              <el-option 
                v-for="font in availableFonts" 
                :key="font.value" 
                :label="font.label" 
                :value="font.value"
              />
            </el-select>
          </el-form-item>
          
          <el-form-item label="Â≠ó‰ΩìÂ§ßÂ∞è">
            <el-input-number 
              v-model="styleForm.fontSize" 
              :min="8" 
              :max="72" 
              :step="1"
              style="width: 100%"
            />
          </el-form-item>
          
          <el-form-item label="Â≠ó‰ΩìÈ¢úËâ≤">
            <el-color-picker 
              v-model="styleForm.fontColor" 
              :predefine="predefineColors"
              show-alpha
            />
          </el-form-item>
          
          <el-form-item label="ËÉåÊôØÈ¢úËâ≤">
            <el-color-picker 
              v-model="styleForm.backgroundColor" 
              :predefine="predefineColors"
              show-alpha
            />
          </el-form-item>
          
          <!-- È´òÁ∫ßÊ†∑Âºè -->
          <el-divider content-position="left">È´òÁ∫ßÊ†∑Âºè</el-divider>
          
          <el-form-item label="Ë°åÈ´ò">
            <el-input-number 
              v-model="styleForm.lineHeight" 
              :min="0.5" 
              :max="3" 
              :step="0.1"
              style="width: 100%"
            />
          </el-form-item>
          
          <el-form-item label="Â≠óÈó¥Ë∑ù">
            <el-input-number 
              v-model="styleForm.letterSpacing" 
              :min="0" 
              :max="20" 
              :step="1"
              style="width: 100%"
            />
          </el-form-item>
          
          <el-form-item label="ÊèèËæπÂÆΩÂ∫¶">
            <el-input-number 
              v-model="styleForm.textStroke.width" 
              :min="0" 
              :max="10" 
              :step="0.5"
              style="width: 100%"
            />
          </el-form-item>
          
          <el-form-item label="ÊèèËæπÈ¢úËâ≤">
            <el-color-picker 
              v-model="styleForm.textStroke.color" 
              :predefine="predefineColors"
              show-alpha
            />
          </el-form-item>
          
          <!-- Èò¥ÂΩ±ËÆæÁΩÆ -->
          <el-divider content-position="left">Èò¥ÂΩ±ËÆæÁΩÆ</el-divider>
          
          <el-form-item label="Èò¥ÂΩ±È¢úËâ≤">
            <el-color-picker 
              v-model="styleForm.textShadow.color" 
              :predefine="predefineColors"
              show-alpha
            />
          </el-form-item>
          
          <el-form-item label="Èò¥ÂΩ±ÂÅèÁßªX">
            <el-input-number 
              v-model="styleForm.textShadow.offsetX" 
              :min="-20" 
              :max="20" 
              :step="1"
              style="width: 100%"
            />
          </el-form-item>
          
          <el-form-item label="Èò¥ÂΩ±ÂÅèÁßªY">
            <el-input-number 
              v-model="styleForm.textShadow.offsetY" 
              :min="-20" 
              :max="20" 
              :step="1"
              style="width: 100%"
            />
          </el-form-item>
          
          <el-form-item label="Èò¥ÂΩ±Ê®°Á≥ä">
            <el-input-number 
              v-model="styleForm.textShadow.blur" 
              :min="0" 
              :max="20" 
              :step="1"
              style="width: 100%"
            />
          </el-form-item>
          
          <!-- ‰ΩçÁΩÆÂíåÂØπÈΩê -->
          <el-divider content-position="left">‰ΩçÁΩÆÂíåÂØπÈΩê</el-divider>
          
          <el-form-item label="ÂØπÈΩêÊñπÂºè">
            <el-select v-model="styleForm.alignment" placeholder="ÈÄâÊã©ÂØπÈΩêÊñπÂºè">
              <el-option label="Â∑¶‰∏ã" :value="1" />
              <el-option label="‰∏≠‰∏ã" :value="2" />
              <el-option label="Âè≥‰∏ã" :value="3" />
              <el-option label="Â∑¶‰∏≠" :value="4" />
              <el-option label="‰∏≠‰∏≠" :value="5" />
              <el-option label="Âè≥‰∏≠" :value="6" />
              <el-option label="Â∑¶‰∏ä" :value="7" />
              <el-option label="‰∏≠‰∏ä" :value="8" />
              <el-option label="Âè≥‰∏ä" :value="9" />
            </el-select>
          </el-form-item>
          
          <el-form-item label="Â∑¶ËæπË∑ù">
            <el-input-number 
              v-model="styleForm.margins.left" 
              :min="0" 
              :max="500" 
              :step="10"
              style="width: 100%"
            />
          </el-form-item>
          
          <el-form-item label="Âè≥ËæπË∑ù">
            <el-input-number 
              v-model="styleForm.margins.right" 
              :min="0" 
              :max="500" 
              :step="10"
              style="width: 100%"
            />
          </el-form-item>
          
          <el-form-item label="ÂûÇÁõ¥ËæπË∑ù">
            <el-input-number 
              v-model="styleForm.margins.vertical" 
              :min="0" 
              :max="200" 
              :step="5"
              style="width: 100%"
            />
          </el-form-item>
          
          <!-- Ê†∑ÂºèÂ±ûÊÄß -->
          <el-divider content-position="left">Ê†∑ÂºèÂ±ûÊÄß</el-divider>
          
          <el-form-item label="Ê†∑Âºè">
            <el-checkbox-group v-model="styleOptions">
              <el-checkbox label="bold">Á≤ó‰Ωì</el-checkbox>
              <el-checkbox label="italic">Êñú‰Ωì</el-checkbox>
              <el-checkbox label="underline">‰∏ãÂàíÁ∫ø</el-checkbox>
              <el-checkbox label="strikeOut">Âà†Èô§Á∫ø</el-checkbox>
            </el-checkbox-group>
          </el-form-item>
          
          <el-form-item label="Áº©ÊîæX">
            <el-input-number 
              v-model="styleForm.scaleX" 
              :min="50" 
              :max="200" 
              :step="5"
              style="width: 100%"
            />
          </el-form-item>
          
          <el-form-item label="Áº©ÊîæY">
            <el-input-number 
              v-model="styleForm.scaleY" 
              :min="50" 
              :max="200" 
              :step="5"
              style="width: 100%"
            />
          </el-form-item>
          
          <el-form-item label="ÊóãËΩ¨ËßíÂ∫¶">
            <el-input-number 
              v-model="styleForm.angle" 
              :min="-360" 
              :max="360" 
              :step="1"
              style="width: 100%"
            />
          </el-form-item>
        </el-form>
        
        <div class="action-buttons">
          <el-button type="primary" @click="applyStyle">Â∫îÁî®Ê†∑Âºè</el-button>
          <el-button @click="resetStyle">ÈáçÁΩÆ</el-button>
        </div>
      </div>
    </el-card>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import { ElMessage } from 'element-plus'
// ‰∏¥Êó∂Ê≥®ÈáäÂõæÊ†áÂØºÂÖ•
// import { Collection, Plus } from '@element-plus/icons-vue'
import type { ASSStyle } from '../../types/subtitle'

interface Props {
  style?: Partial<ASSStyle>
}

interface Emits {
  (e: 'styleChange', style: Partial<ASSStyle>): void
}

const props = withDefaults(defineProps<Props>(), {
  style: () => ({})
})

const emit = defineEmits<Emits>()

const styleForm = ref<Partial<ASSStyle>>({
  fontName: 'Arial',
  fontSize: 16,
  fontColor: '#FFFFFF',
  backgroundColor: '#000000',
  lineHeight: 1.2,
  letterSpacing: 0,
  textStroke: {
    color: '#000000',
    width: 0
  },
  textShadow: {
    color: '#000000',
    offsetX: 0,
    offsetY: 0,
    blur: 0
  },
  alignment: 2,
  margins: {
    left: 0,
    right: 0,
    vertical: 0
  },
  bold: false,
  italic: false,
  underline: false,
  strikeOut: false,
  scaleX: 100,
  scaleY: 100,
  angle: 0
})

const styleOptions = ref<string[]>([])

const availableFonts = ref([
  { value: 'Arial', label: 'Arial' },
  { value: 'Times New Roman', label: 'Times New Roman' },
  { value: 'Microsoft YaHei', label: 'ÂæÆËΩØÈõÖÈªë' },
  { value: 'ÂçéÊñáÊ•∑‰Ωì', label: 'ÂçéÊñáÊ•∑‰Ωì' },
  { value: 'OPlusSans 3.0 Medium', label: 'OPlusSans 3.0 Medium' },
  { value: 'Helvetica', label: 'Helvetica' },
  { value: 'Calibri', label: 'Calibri' },
  { value: 'Verdana', label: 'Verdana' }
])

const predefineColors = ref([
  '#FFFFFF',
  '#000000',
  '#FF0000',
  '#00FF00',
  '#0000FF',
  '#FFFF00',
  '#FF00FF',
  '#00FFFF',
  '#FFA500',
  '#800080',
  '#FFC0CB',
  '#A52A2A'
])

const updateStyleOptions = () => {
  styleOptions.value = []
  if (styleForm.value.bold) styleOptions.value.push('bold')
  if (styleForm.value.italic) styleOptions.value.push('italic')
  if (styleForm.value.underline) styleOptions.value.push('underline')
  if (styleForm.value.strikeOut) styleOptions.value.push('strikeOut')
}

// ÁõëÂê¨Ê†∑ÂºèÂèòÂåñ
watch(() => props.style, (newStyle) => {
  if (newStyle) {
    Object.assign(styleForm.value, newStyle)
    updateStyleOptions()
  }
}, { immediate: true, deep: true })

// ÁõëÂê¨Ê†∑ÂºèÈÄâÈ°πÂèòÂåñ
watch(styleOptions, (newOptions) => {
  styleForm.value.bold = newOptions.includes('bold')
  styleForm.value.italic = newOptions.includes('italic')
  styleForm.value.underline = newOptions.includes('underline')
  styleForm.value.strikeOut = newOptions.includes('strikeOut')
}, { deep: true })

const applyStyle = () => {
  emit('styleChange', { ...styleForm.value })
  ElMessage.success('Ê†∑ÂºèÂ∑≤Â∫îÁî®')
}

const resetStyle = () => {
  styleForm.value = {
    fontName: 'Arial',
    fontSize: 16,
    fontColor: '#FFFFFF',
    backgroundColor: '#000000',
    lineHeight: 1.2,
    letterSpacing: 0,
    textStroke: {
      color: '#000000',
      width: 0
    },
    textShadow: {
      color: '#000000',
      offsetX: 0,
      offsetY: 0,
      blur: 0
    },
    alignment: 2,
    margins: {
      left: 0,
      right: 0,
      vertical: 0
    },
    bold: false,
    italic: false,
    underline: false,
    strikeOut: false,
    scaleX: 100,
    scaleY: 100,
    angle: 0
  }
  styleOptions.value = []
  ElMessage.info('Ê†∑ÂºèÂ∑≤ÈáçÁΩÆ')
}

const loadPreset = () => {
  // TODO: ÂÆûÁé∞È¢ÑËÆæÂä†ËΩΩÂäüËÉΩ
  ElMessage.info('È¢ÑËÆæÂä†ËΩΩÂäüËÉΩÂºÄÂèë‰∏≠...')
}

const savePreset = () => {
  // TODO: ÂÆûÁé∞È¢ÑËÆæ‰øùÂ≠òÂäüËÉΩ
  ElMessage.info('È¢ÑËÆæ‰øùÂ≠òÂäüËÉΩÂºÄÂèë‰∏≠...')
}
</script>

<style scoped>
.style-panel {
  height: 100%;
}

.style-card {
  height: 100%;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.style-content {
  height: calc(100% - 60px);
  overflow: auto;
}

.action-buttons {
  margin-top: 20px;
  text-align: center;
}

.action-buttons .el-button {
  margin: 0 10px;
}

:deep(.el-divider) {
  margin: 15px 0;
}

:deep(.el-form-item) {
  margin-bottom: 15px;
}

:deep(.el-checkbox-group) {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}
</style>